# Data Model Overview

Vehicle Wellness Center stores structured vehicle metadata and a flexible event ledger to capture historical and future maintenance activity.

## Collections

### vehicles

Represents a single vehicle under management.

- `_id` (ObjectId)
- `vin` (string, unique) ‚Äì normalized VIN.
- `name` (string) ‚Äì friendly label (e.g., "Family SUV").
- `acquiredAt` (ISODate) ‚Äì acquisition timestamp.
- `acquiredFrom` (object) ‚Äì `{ dealerName, dealerId?, address? }`.
- `initialOdometer` (number)
- `currentOdometer` (number) ‚Äì last known mileage.
- `attributes` (object) ‚Äì dynamic fields like trim, color, drivetrain, packages.
- `valuation` (object) ‚Äì `{ source, amount, currency, asOf }`.
- `ownership` (object) ‚Äì `{ ownerId, ownerName, garageLocation }`.
- `tags` (array of strings) ‚Äì e.g., `['daily-driver', 'warranty']`.
- `createdAt` / `updatedAt` (ISODate)

Indexes:

- Unique index on `vin`.
- Optional compound index on `{ ownerId, vin }` to support multi-vehicle fleets.

### vehicleEvents

Chronological ledger of everything that happens to a vehicle.

- `_id` (ObjectId)
- `vehicleId` (ObjectId, ref vehicles)
- `occurredAt` (ISODate)
- `recordedAt` (ISODate)
- `location` (object) ‚Äì `{ name?, address?, geo? }`
- `type` (string) ‚Äì enumerated event codes (e.g., `maintenance.oil-change`, `incident.collision`, `upgrade.audio`).
- `emoji` (string) ‚Äì presentation glyph per event type.
- `summary` (string) ‚Äì short headline for timeline view.
- `details` (object) ‚Äì flexible payload tailored per event type.
  - Core shared keys: `odometerIn?`, `odometerOut?`, `serviceAdvisor?`, `provider?`.
  - Arrays: `services[]`, `parts[]`, `labor[]` each with `{ description, cost, currency, metadata? }`.
  - `codes[]` ‚Äì diagnostic/maintenance codes.
  - `notes[]` ‚Äì free-form annotated entries with author + timestamp.
- `source` (object) ‚Äì e.g., `{ channel: 'dealer-upload', referenceId: 'RO-12345' }`.
- `attachments[]` ‚Äì metadata for stored documents (URLs, S3 keys, MIME types).
- `forecast` (object) ‚Äì optional predictive maintenance data generated by chat/AI modules.
- `createdBy` (object) ‚Äì `{ userId, name }`.
- `createdAt` / `updatedAt` (ISODate)

Indexes:

- Compound index `{ vehicleId: 1, occurredAt: -1 }` for timeline queries.
- Optional index on `{ type: 1, occurredAt: -1 }` for filtering by event category.

## Reference Tables

### eventTypes (optional embedded config)

If event taxonomy needs centralized management, maintain a configuration document containing the allowed `type`, `emoji`, and default form schema per event.

## Derived Views

- **Vehicle summaries** ‚Äì computed views/materialized collections storing latest valuation, next maintenance due, and recent events for fast dashboard loads.
- **Chat knowledge base** ‚Äì preprocessed snippets compiled from vehicles and events for conversational context.

## Sample Documents

### vehicles (sample)

```json
{
  "_id": ObjectId("66f0..."),
  "vin": "1FTFW1E85PKD12345",
  "name": "Family Explorer",
  "acquiredAt": ISODate("2023-05-12T15:30:00Z"),
  "acquiredFrom": {
    "dealerName": "Metro Ford",
    "address": "123 Dealer Way, Austin, TX"
  },
  "initialOdometer": 12000,
  "currentOdometer": 38500,
  "attributes": {
    "year": 2022,
    "make": "Ford",
    "model": "Explorer",
    "trim": "Limited",
    "color": "Blue",
    "drivetrain": "AWD"
  },
  "valuation": {
    "source": "kbb",
    "amount": 32950,
    "currency": "USD",
    "asOf": ISODate("2025-10-01T00:00:00Z")
  },
  "ownership": {
    "ownerId": "fleet-001",
    "ownerName": "Wellness Vehicles LLC",
    "garageLocation": "Austin, TX"
  },
  "tags": ["family", "warranty"],
  "createdAt": ISODate("2023-05-12T15:30:00Z"),
  "updatedAt": ISODate("2025-10-01T08:42:00Z")
}
```

### vehicleEvents (sample)

```json
{
  "_id": ObjectId("66f1..."),
  "vehicleId": ObjectId("66f0..."),
  "occurredAt": ISODate("2025-09-18T14:00:00Z"),
  "recordedAt": ISODate("2025-09-19T02:12:00Z"),
  "location": {
    "name": "Metro Ford Service",
    "address": "123 Dealer Way, Austin, TX"
  },
  "type": "maintenance.oil-change",
  "emoji": "üõ¢Ô∏è",
  "summary": "Oil change and inspection",
  "details": {
    "odometerIn": 38020,
    "odometerOut": 38020,
    "services": [
      { "description": "Full synthetic oil change", "cost": 89.99, "currency": "USD" },
      { "description": "Multi-point inspection", "cost": 0, "currency": "USD" }
    ],
    "parts": [
      { "partNumber": "FL-500S", "description": "Oil filter", "quantity": 1, "cost": 14.5, "currency": "USD" }
    ],
    "codes": ["RO-56321"],
    "notes": [
      {
        "author": "Service Advisor",
        "message": "Recommended tire rotation next visit",
        "timestamp": ISODate("2025-09-19T02:05:00Z")
      }
    ]
  },
  "source": {
    "channel": "dealer-upload",
    "referenceId": "RO-56321"
  },
  "forecast": {
    "nextMaintenance": ISODate("2026-01-18T00:00:00Z"),
    "suggestedServices": ["tire-rotation"]
  },
  "createdBy": {
    "userId": "svc-robot",
    "name": "Dealer Import Connector"
  },
  "createdAt": ISODate("2025-09-19T02:12:00Z"),
  "updatedAt": ISODate("2025-09-19T02:12:00Z")
}
```

## Dealer Maintenance Record Mapping

The following dealer records can be ingested as `vehicleEvents` by aligning descriptions to event types and emojis.

| Date       | Dealer Description                                                                 | Provider                 | Odometer |
|------------|-------------------------------------------------------------------------------------|--------------------------|----------|
| 2025-06-12 | Vehicle inspection, electrical diagnostics, miscellaneous adjustments               | Fowler Jeep of Boulder   | 40664    |
| 2025-05-16 | Miscellaneous service (extra keys)                                                 | Fowler Jeep of Boulder   | 40289    |
| 2024-05-29 | Diagnostic system test, vehicle inspection, air filter service                     | Fowler Jeep of Boulder   | 36315    |
| 2023-10-04 | Flat repair, vehicle inspection, wheels & tires verification                       | Fowler Jeep of Boulder   | 33214    |
| 2022-09-14 | Mopar express lane oil service, tire rotation/balance, vehicle inspection          | Fowler Jeep of Boulder   | 27332    |
| 2021-04-30 | Mopar express lane oil service, tire rotation/balance, vehicle inspection          | Fowler Jeep of Boulder   | 21183    |
| 2019-10-04 | Lube/oil/filter service, express inspection                                        | Fowler Jeep of Boulder   | 13493    |
| 2019-03-15 | Flat repair                                                                        | Fowler Jeep of Boulder   | 9471     |
| 2018-09-06 | Electrical system service, miscellaneous fixes, lube/oil/filter, tire rotation     | Fowler Jeep of Boulder   | ‚Äî        |

Example event JSON derived from the 2025-06-12 record:

```json
{
  "vehicleId": ObjectId("66f0..."),
  "occurredAt": ISODate("2025-06-12T00:00:00Z"),
  "recordedAt": ISODate("2025-06-13T02:12:00Z"),
  "type": "inspection.comprehensive",
  "emoji": "üß∞",
  "summary": "Comprehensive inspection and electrical diagnostics",
  "location": {
    "name": "Fowler Jeep of Boulder"
  },
  "details": {
    "odometerIn": 40664,
    "services": [
      { "description": "Vehicle inspection", "cost": null },
      { "description": "Electrical system diagnostic", "cost": null },
      { "description": "Miscellaneous adjustments", "cost": null }
    ],
    "notes": [
      { "author": "Dealer upload", "message": "Dealer record linked", "timestamp": ISODate("2025-06-13T02:12:00Z") }
    ]
  },
  "source": {
    "channel": "dealer-upload",
    "referenceId": "FJB-2025-06-12"
  },
  "createdBy": {
    "userId": "svc-dealer-import",
    "name": "Dealer Import Connector"
  },
  "createdAt": ISODate("2025-06-13T02:12:00Z"),
  "updatedAt": ISODate("2025-06-13T02:12:00Z")
}
```

## Design Considerations

- **Flexibility vs. structure** ‚Äì core fields enable consistent querying, while the `details` object supports type-specific payloads shaped by event templates.
- **Emoji mapping** ‚Äì maintain a shared lookup (config document or code enum) so UI components can render consistent icons.
- **Auditability** ‚Äì timestamps, `source`, and `createdBy` provide traceability for imported data and manual edits.
- **Performance** ‚Äì timeline queries rely on `{ vehicleId, occurredAt }` index and optional projections to feed the UI history panel.
- **Future expansion** ‚Äì multi-vehicle fleets only require additional ownership metadata and potentially a `fleetId` field on vehicles/events.
